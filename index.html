<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>W.I.T.</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Dark (refined) */
      --bg-main: linear-gradient(135deg, #020617, #020617);
      --card-bg: #0b1220;
      --panel-bg: #020617;
      --panel-bg-strong: #0f172a;
      --border: #1e293b;

      --text-main: #cbd5e1;
      --text-strong: #f8fafc;
      --text-muted: #94a3b8;

      /* í¬ì¸íŠ¸ ì»¬ëŸ¬ ì ˆì œ */
      --primary: #64748b;          /* slate */
      --primary-strong: #475569;   /* slate-dark */
      --blue-glow: 0 0 0 rgba(0,0,0,0), 0 0 40px rgba(79,70,229,0.35);
    }

    /* Light mode */
    body.light {
      --bg-main: linear-gradient(135deg, #f3f4f6, #e5e7eb);
      --card-bg: #ffffff;
      --panel-bg: #f9fafb;
      --panel-bg-strong: #eef2ff;
      --border: #e5e7eb;

      --text-main: #1f2937;
      --text-strong: #111827;
      --text-muted: #6b7280;

      --primary: #4f46e5;
      --primary-strong: #4338ca;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: var(--bg-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .card {
      background: var(--card-bg);
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      width: 100%;
      max-width: 500px;
      color: var(--text-main);
      border: 1px solid var(--border);
    }
    /* Dark mode: ì¹´ë“œ ì „ì²´ ë¸”ë£¨ ê¸€ë¡œìš° */
    body:not(.light) .card {
      box-shadow:
        0 10px 40px rgba(0,0,0,0.3),
        0 0 30px rgba(79,70,229,0.15);
    }
    h1 {
      margin: 0 0 24px;
      font-size: 28px;
      text-align: center;
      color: var(--text-strong);
      font-family: "Playfair Display", "Times New Roman", serif;
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    .setup-section {
      margin-bottom: 20px;
    }
    .row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .field {
      flex: 1;
    }
    label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 6px;
      display: block;
    }
    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid var(--border);
      background: var(--panel-bg);
      color: var(--text-strong);
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }
    select:focus, input[type="text"]:focus, input[type="number"]:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.25);
    }
    #wordBox {
      margin: 20px 0;
      padding: 24px;
      border-radius: 12px;
      background: var(--panel-bg-strong);
      text-align: center;
      font-size: 32px;
      font-weight: 700;
      color: var(--text-strong);
      letter-spacing: 0.5px;
      box-shadow: inset 0 0 0 1px var(--border);
    }
    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    button {
      flex: 1;
      padding: 14px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:active {
      transform: translateY(2px);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-start {
      background: linear-gradient(135deg, var(--primary-strong), var(--primary));
      color: #ffffff;
      width: 100%;
      padding: 16px;
      font-size: 16px;
      box-shadow: 0 6px 20px rgba(79,70,229,0.5);
    }
    .btn-check {
      background: var(--primary-strong);
      color: #ffffff;
      box-shadow: none;
    }
    .btn-check:hover:not(:disabled) {
      background: var(--primary);
    }
    .btn-check.btn-gray {
      background: #6b7280;
      color: #ffffff;
    }
    .btn-check.btn-gray:hover:not(:disabled) {
      background: #4b5563;
    }
    .btn-next {
      background: var(--panel-bg);
      color: var(--text-main);
      border: 1px solid var(--border);
    }
    .btn-next:hover:not(:disabled) {
      background: var(--panel-bg);
      border-color: var(--primary);
    }
    .result {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      min-height: 20px;
    }
    .result.correct {
      background: #064e3b;
      color: #d1fae5;
    }
    .result.partial {
      background: #78350f;
      color: #fde68a;
    }
    .result.wrong {
      background: #6b2828;
      color: #fca5a5;
    }

    body.light .result.correct {
      background: #d1fae5;
      color: #065f46;
    }
    body.light .result.partial {
      background: #fff3cd;
      color: #856404;
    }
    body.light .result.wrong {
      background: #f8d7da;
      color: #721c24;
    }
    #correctBox {
      margin-top: 8px;
      padding: 10px;
      background: var(--panel-bg);
      border-radius: 8px;
      font-size: 14px;
      color: var(--text-main);
      text-align: center;
      display: none;
    }
    #scoreBox,
    .hint,
    .progress-info {
      margin-top: 16px;
      padding: 12px;
      background: var(--panel-bg);
      border-radius: 8px;
      font-size: 14px;
      color: var(--text-main);
      text-align: center;
      font-weight: 600;
    }
    .hint {
      margin-top: 20px;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
    }
    #quizSection { 
      display: none;
    }
    .visible {
      display: block !important;
    }
    .btn-home {
      background: #6c757d;
      color: #fff;
      margin-top: 16px;
      width: 100%;
    }
    .btn-home:hover:not(:disabled) {
      background: #5a6268;
    }
    #resultSection {
      display: none;
      text-align: center;
    }
    .final-score {
      margin: 24px 0;
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      color: white;
    }
    .final-score h2 {
      margin: 0 0 16px;
      font-size: 24px;
    }
    .final-score .big-number {
      font-size: 48px;
      font-weight: 700;
      margin: 16px 0;
    }
    .final-score .detail {
      font-size: 18px;
      opacity: 0.9;
    }
    /* .progress-info, #scoreBox handled above */
    .exam-badges-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
      align-items: center;
    }
    .exam-mode-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-practice {
      background: #b8d4f0;
      color: #2c5282;
      border: none;
    }
    .badge-real {
      background: #f9e4b7;
      color: #7b5213;
      border: none;
    }
    .badge-day {
      background: #d5c4ed;
      color: #5b3f7e;
      border: none;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Light mode: í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½ */
    body.light .badge-practice {
      background: #b8d4f0;
      color: #2c5282;
    }
    body.light .badge-real {
      background: #f9e4b7;
      color: #7b5213;
    }
    body.light .badge-day {
      background: #d5c4ed;
      color: #5b3f7e;
    }

    /* Light mode: ë²„íŠ¼ ê·¸ë¦¼ì ì œê±° */
    body.light .btn-start {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    body.light .btn-check {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* í‹€ë¦°ë‹¨ì–´ ì‹œí—˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-wrong-quiz {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
    }

    body.light .btn-wrong-quiz {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    }

    /* í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #themeToggle {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-main);
    }

    /* í‹€ë¦°ë‹¨ì–´ ë³µìŠµ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .badge-wrong-review {
      background: #b2404f;
      color: #ffffff;
      border: none;
    }

    body.light .badge-wrong-review {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: #ffffff;
    }
    .wrong-word-item {
      padding: 12px;
      margin: 8px 0;
      background: #fff;
      border: 2px solid #f8d7da;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .wrong-word-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .wrong-word-right-col {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      flex-shrink: 0;
    }
    .wrong-word-info {
      flex: 1;
    }
    /* ìƒì„¸ ê¸°ë¡ í† ê¸€ ë²„íŠ¼ */
    .detail-toggle-btn {
      background: none;
      border: 1px solid #d1d5db;
      border-radius: 12px;
      color: #374151;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 10px;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.15s;
    }
    .detail-toggle-btn:hover {
      background: #f3f4f6;
    }
    /* ìƒì„¸ íŒ¨ë„ */
    .detail-panel {
      margin-top: 10px;
      padding: 10px 12px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .detail-report-title {
      font-size: 12px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 8px;
    }
    .detail-missed-row {
      margin-bottom: 6px;
    }
    .detail-missed-bar-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .detail-missed-label {
      font-size: 12px;
      color: #111827;
      min-width: 80px;
      flex-shrink: 0;
      font-weight: 500;
    }
    .detail-bar-track {
      flex: 1;
      background: #e5e7eb;
      border-radius: 4px;
      height: 8px;
      overflow: hidden;
    }
    .detail-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    .detail-cnt-badge {
      font-size: 11px;
      font-weight: 700;
      color: #dc2626;
      min-width: 28px;
      text-align: right;
      flex-shrink: 0;
    }
    /* ë‹¤í¬ëª¨ë“œ ìƒì„¸ íŒ¨ë„ */
    body:not(.light) .wrong-word-item {
      background: #1e293b;
      border-color: #7f1d1d;
    }
    body:not(.light) .detail-panel {
      background: #1e293b;
      border-color: #334155;
    }
    body:not(.light) .detail-report-title { color: #f1f5f9; }
    body:not(.light) .detail-missed-label { color: #cbd5e1; }
    body:not(.light) .detail-bar-track { background: #334155; }
    body:not(.light) .detail-cnt-badge { color: #fca5a5; }
    body:not(.light) .detail-toggle-btn {
      border-color: #475569;
      color: #cbd5e1;
    }
    body:not(.light) .detail-toggle-btn:hover { background: #334155; }
    body:not(.light) .wrong-word-english { color: #f1f5f9; }
    body:not(.light) .wrong-word-meaning { color: #94a3b8; }
    .wrong-word-english {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 4px;
    }
    .wrong-word-meaning {
      font-size: 14px;
      color: #666;
    }
    .wrong-word-count {
      background: #dc3545;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }
    .wrong-count-1 { background: #ffebee; color: #c62828; }
    .wrong-count-2 { background: #ffcdd2; color: #b71c1c; }
    .wrong-count-3 { background: #ef9a9a; color: #8b0000; }
    .wrong-count-4 { background: #e57373; color: white; }
    .wrong-count-5 { background: #ef5350; color: white; }
    .wrong-count-6 { background: #f44336; color: white; }
    .wrong-count-7 { background: #e53935; color: white; }
    .wrong-count-8 { background: #d32f2f; color: white; }
    .wrong-count-9 { background: #c62828; color: white; }
    .wrong-count-10 { background: #8b0000; color: white; font-weight: 800; }

    .selected-days-preview {
      font-size: 14px;
      color: var(--text-main);
      font-weight: 600;
    }

    .day-selector {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: var(--panel-bg);
    }

    .day-selector-header {
      background: var(--panel-bg);
      color: var(--text-strong);
      padding: 12px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .day-selector-header:hover {
      background: var(--panel-bg-strong);
    }

    .selected-days-preview {
      color: var(--text-main); /* ë³´ë¼ìƒ‰ ì œê±° */
      font-weight: 600;
    }

    .day-selector-content {
      margin-top: 8px;
      border-radius: 8px;
      overflow-y: auto;
      max-height: 240px;
      /* âœ… ê¸°ë³¸ì€ ì ‘í˜ */
      display: none;
    }

    .day-selector-content.expanded {
      display: block;
    }

    .day-option {
      padding: 10px 12px;
      color: var(--text-main);
      /* âœ… ì²´í¬ë°•ìŠ¤/í…ìŠ¤íŠ¸ ìˆ˜í‰ì •ë ¬ */
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .day-option input[type="checkbox"] {
      margin: 0;
      width: 16px;
      height: 16px;
      flex: 0 0 auto;
    }

    .day-option label {
      margin: 0;
      font-size: 14px;
      line-height: 1.4;
      color: var(--text-main);
      cursor: pointer;
    }

    .day-option:hover {
      background: var(--panel-bg-strong);
    }
    .arrow-icon {
      transition: transform 0.3s;
    }
    .arrow-icon.expanded {
      transform: rotate(180deg);
    }

    /* Light mode: Day selector ê°€ë…ì„± ë³´ì • */
    body.light .day-option {
      color: var(--text-main);
    }

    body.light .day-selector {
      background: #ffffff;
    }
    /* CSV ì–‘ì‹ ë²„íŠ¼ ë³´ë” ìƒ‰ìƒ (ì§„í•œ íšŒìƒ‰ ìœ ì§€) */
    #downloadTemplateBtn {
      border-color: #9ca3af;
    }
    body:not(.light) #downloadTemplateBtn {
      border-color: #475569;
    }
    /* ë‹¨ì–´í˜„í™© / ì´ˆê¸°í™” ë²„íŠ¼ ë³´ë”: ë‹¤ë¥¸ UI ìš”ì†Œì™€ ë™ì¼í•œ ìƒ‰ìƒ */
    #savedWordsStatus, #clearWordsBtn {
      border-color: var(--border);
    }
    /* Lexio title & subtitle */
    .lexio-title {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-bottom: 24px;
    }

    .lexio-title span {
      display: block;
    }

    .wit-main {
      font-family: "Bebas Neue", "Impact", sans-serif;
      font-size: 52px;
      font-weight: 400;
      letter-spacing: 0.12em;
      color: var(--text-strong);
      line-height: 1;
    }
    .wit-fullname {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      text-transform: uppercase;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin-top: 2px;
      margin-bottom: 4px;
    }
    .lexio-subtitle {
      font-size: 15px;
      font-weight: 400;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      font-style: italic;
      font-family: "Playfair Display", "Times New Roman", serif;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1 class="lexio-title">
      <span class="wit-main">W.I.T.</span>
      <span class="wit-fullname">Words â€“ Intelligence â€“ Training</span>
      <span class="lexio-subtitle">Words Shape Thinking</span>
    </h1>
    <div style="display:flex; justify-content:flex-end; margin-bottom:12px;">
      <button id="themeToggle" style="border-radius: 20px; padding: 6px 12px; cursor: pointer; font-size: 12px;">
        ğŸŒ™ Dark
      </button>
    </div>

    <div class="setup-section" id="setupSection">
      <div style="
        margin-bottom: 20px;
        padding: 16px;
        background: var(--panel-bg-strong);
        border-radius: 12px;
        border: 1px solid var(--border);
      ">
        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-main);">
          ğŸ“ íŒŒì¼ ì—…ë¡œë“œ (ì—‘ì…€ ë˜ëŠ” CSV)
        </label>
        <input type="file" id="excelFile" accept=".xlsx,.xls,.csv"
          style="
            width: 100%;
            padding: 12px;
            border: 1px dashed var(--border);
            border-radius: 10px;
            background: var(--panel-bg);
            color: var(--text-main);
            cursor: pointer;
          ">
        <div style="margin-top: 8px;">
          <button id="fileDetailToggleBtn" onclick="(function(){const p=document.getElementById('fileDetailPanel');const a=document.getElementById('fileDetailArrow');const open=p.style.display!=='none';p.style.display=open?'none':'block';a.textContent=open?'â–¶':'â–¼';})()" style="
            background: none;
            border: none;
            padding: 2px 0;
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
          ">
            <span id="fileDetailArrow">â–¶</span> ìƒì„¸ ì„¤ëª…
          </button>
          <div id="fileDetailPanel" style="display: none; margin-top: 6px; font-size: 12px; color: var(--text-muted); line-height: 1.8;">
            ğŸ’¡ íŒŒì¼ í˜•ì‹: <strong style="color: var(--text-main);">Category | Words | Meanings | Synonyms</strong><br>
            ğŸ“„ ì§€ì› í˜•ì‹: .xlsx, .xls, .csv<br>
            âœï¸ ì—¬ëŸ¬ ê°œì˜ ëœ»/ë™ì˜ì–´ëŠ” <strong style="color: var(--text-main);">ì½¤ë§ˆ(,)</strong>ë¡œ êµ¬ë¶„í•´ì„œ ì…ë ¥í•˜ì„¸ìš”<br>
            &nbsp;&nbsp;&nbsp;&nbsp;ì˜ˆ) Meanings: <em>ë²„ë¦¬ë‹¤, í¬ê¸°í•˜ë‹¤</em> &nbsp;/&nbsp; Synonyms: <em>desert, give up</em>
          </div>
        </div>
        <!-- CSV ì–‘ì‹ ë‹¤ìš´ë¡œë“œ (ë‹¨ë…) -->
        <button id="downloadTemplateBtn" style="
          margin-top: 10px;
          width: 100%;
          padding: 9px 12px;
          border-radius: 8px;
          border: 1px solid;
          background: none;
          color: var(--text-muted);
          font-size: 12px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.15s;
        ">ğŸ“¥ CSV ì–‘ì‹</button>
        <!-- ë‹¨ì–´ í˜„í™© + ì´ˆê¸°í™” ë‘ ë²ˆì§¸ ì¤„ -->
        <div style="margin-top: 8px; display: flex; gap: 8px; align-items: center;">
          <div id="savedWordsStatus" style="display:none; flex: 8; padding: 7px 12px; border-radius: 8px; border: 1px solid var(--border); justify-content: center; align-items: center; min-width: 0;">
            <span id="savedWordsInfo" style="font-size: 12px; color: var(--text-main); text-align: center; display: block;"></span>
          </div>
          <button id="clearWordsBtn" style="
            display: none;
            flex: 2;
            width: fit-content;
            align-self: center;
            padding: 5px 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: none;
            color: var(--text-muted);
            font-size: 16px;
            cursor: pointer;
            line-height: 1;
            text-align: center;
          ">ğŸ—‘</button>
        </div>
      </div>

      <div class="field" style="margin-bottom: 16px;">
        <label>Category ì„ íƒ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥)</label>
        <div class="day-selector">
          <div class="day-selector-header" id="daySelectorHeader">
            <span class="selected-days-preview" id="selectedDaysPreview">ì„ íƒí•˜ì„¸ìš”</span>
            <span class="arrow-icon" id="arrowIcon">â–¼</span>
          </div>
          <div class="day-selector-content" id="daySelectorContent">
            <!-- Category ì˜µì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="modeSelect">ì‹œí—˜ ìœ í˜•</label>
          <select id="modeSelect">
            <option value="meaning">ëœ» ì“°ê¸° (ì˜â†’í•œ)</option>
            <option value="synonym">ë™ì˜ì–´ (ì˜â†’ì˜)</option>
          </select>
        </div>
        <div class="field">
          <label for="examMode">ì‹œí—˜ ëª¨ë“œ</label>
          <select id="examMode">
            <option value="practice">ì—°ìŠµ ëª¨ë“œ</option>
            <option value="real">ì‹¤ì „ ëª¨ë“œ</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="questionCount">ë¬¸ì œ ê°œìˆ˜ <span style="font-size: 12px; color: #666; font-weight: normal;">ğŸ’¡ 0 ì…ë ¥ ì‹œ ì „ì²´ ë¬¸ì œ ì¶œì œ</span></label>
          <input type="number" id="questionCount" min="0" value="0" placeholder="0" style="width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e0e0e0; font-size: 15px; outline: none; transition: all 0.2s;"
                 onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)'"
                 onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'" />
          <div id="questionCountWarning" style="display: none; margin-top: 6px; font-size: 12px; color: #dc3545; font-weight: 600;"></div>
        </div>
      </div>

      <button class="btn-start" id="startBtn" style="margin-top: 20px;">ì‹œí—˜ ì‹œì‘í•˜ê¸° ğŸš€</button>

      <div class="hint">
        ğŸ’¡ <strong>ì—°ìŠµëª¨ë“œ</strong>ì—ì„œëŠ” í‹€ë¦° ë¬¸ì œê°€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        í‹€ë¦° ë¬¸ì œë¥¼ ê¸°ì–µí•´ë‘ê³  ì‹¶ë‹¤ë©´ <strong>ì‹¤ì „ëª¨ë“œ</strong>ì—ì„œ ì‹œí—˜ì„ ë³´ì„¸ìš”!
      </div>

      <div class="hint" id="uploadWarning" style="background: #fff3cd; color: #856404; margin-top: 12px;">
        âš ï¸ ë¨¼ì € ìœ„ì—ì„œ ì—‘ì…€ ë˜ëŠ” CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
      </div>

      <div style="display: flex; gap: 12px; margin-top: 16px;" id="wrongWordsBtnsContainer" style="display: none;">
        <button class="btn-next" id="wrongWordsBtn" style="flex: 1; margin: 0;">
          âŒ í‹€ë¦° ë‹¨ì–´ ëª©ë¡
        </button>
        <button class="btn-start btn-wrong-quiz" id="startWrongWordsQuizBtnHome" style="flex: 1; margin: 0;">
          ğŸ“ í‹€ë¦°ë‹¨ì–´ ì‹œí—˜
        </button>
      </div>
    </div>

    <div id="quizSection">
      <div id="wordBox">ë‹¨ì–´</div>

      <div class="field">
        <label for="answerInput" id="answerLabel">ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”</label>
        <input id="answerInput" type="text" autocomplete="off"
               placeholder="ë‹µì„ ì…ë ¥í•˜ê³  Enter ë˜ëŠ” ì •ë‹µ í™•ì¸ í´ë¦­" />
      </div>

      <div class="buttons">
        <button class="btn-check" id="checkBtn">ì •ë‹µ í™•ì¸</button>
        <button class="btn-next" id="nextBtn">ë‹¤ìŒ ë¬¸ì œ â¡ï¸</button>
      </div>

      <div id="result" class="result"></div>
      <div id="correctBox"></div>
      <div id="scoreBox"></div>

      <button class="btn-home" id="homeBtn">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="resultSection">
      <h2>ğŸ‰ ì‹œí—˜ ì™„ë£Œ!</h2>
      
      <div class="final-score">
        <h2>ìµœì¢… ì ìˆ˜</h2>
        <div class="big-number" id="finalRate">0%</div>
        <div class="detail" id="finalDetail">0 / 0 ì •ë‹µ</div>
      </div>

      <div class="progress-info">
        <div id="wrongCount"></div>
        <div id="correctCountText"></div>
      </div>

      <button class="btn-start" id="homeBtn2">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      <button class="btn-next" id="retryBtn" style="margin-top: 12px; width: 100%;">ğŸ”„ ê°™ì€ Category ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <div id="wrongWordsSection" style="display: none;">
      <h2>âŒ í‹€ë¦° ë‹¨ì–´ ëª©ë¡</h2>
      
      <div style="margin: 16px 0; text-align: center;">
        <label for="wrongDayFilter" style="font-size: 14px; margin-right: 8px;">Category í•„í„°:</label>
        <select id="wrongDayFilter" style="padding: 8px; border-radius: 8px; border: 2px solid #e0e0e0;">
          <option value="all">ì „ì²´ ë³´ê¸°</option>
        </select>
      </div>

      <div id="wrongWordsList" style="margin: 20px 0;"></div>

      <div style="margin: 20px 0; padding: 16px; background: #f8f9fa; border-radius: 10px;">
        <h3 style="margin: 0 0 12px; font-size: 16px; color: #333;">ğŸ’¾ ë°±ì—… ë° ë³µêµ¬</h3>
        <div class="buttons">
          <button class="btn-check btn-gray" id="downloadWrongBtn">ğŸ“¥ ê¸°ë¡ ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn-check btn-gray" id="uploadWrongBtn">ğŸ“¤ ê¸°ë¡ ì—…ë¡œë“œ</button>
        </div>
        <input type="file" id="wrongWordsFile" accept=".csv" style="display: none;">
        <div style="margin-top: 8px; font-size: 12px; color: #666; text-align: center;">
          ğŸ’¡ ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ì˜®ê¸°ê±°ë‚˜ ë°±ì—…í•  ë•Œ ì‚¬ìš©í•˜ì„¸ìš”
        </div>
      </div>

      <div class="buttons">
        <button class="btn-start btn-wrong-quiz" id="startWrongWordsQuizBtn">ğŸ“ í‹€ë¦° ë‹¨ì–´ë¡œ ì‹œí—˜ ë³´ê¸°</button>
      </div>

      <div class="buttons" style="margin-top: 12px;">
        <button class="btn-start" id="homeBtn3">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        <button class="btn-next" id="clearWrongBtn">ğŸ—‘ï¸ ê¸°ë¡ ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    /************************************************************
     * 0. ì¸ì½”ë”© ìë™ ê°ì§€ CSV ì½ê¸° í•¨ìˆ˜
     * ë§¥ ì—‘ì…€ì´ BOM ì—†ì´ ì €ì¥í•˜ëŠ” ë¬¸ì œ ëŒ€ì‘
     * UTF-8 â†’ EUC-KR ìˆœìœ¼ë¡œ ì‹œë„, í•œê¸€ ê¹¨ì§ ìë™ ë³µêµ¬
     ************************************************************/
    function readFileWithEncoding(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const buffer = e.target.result;
          const bytes = new Uint8Array(buffer);

          // BOM í™•ì¸ (EF BB BF = UTF-8 BOM)
          const hasBOM = bytes[0] === 0xEF && bytes[1] === 0xBB && bytes[2] === 0xBF;

          if (hasBOM) {
            // BOM ìˆìœ¼ë©´ UTF-8ë¡œ ë””ì½”ë”©
            resolve(new TextDecoder('utf-8').decode(buffer));
          } else {
            // BOM ì—†ìœ¼ë©´ UTF-8 ì‹œë„ í›„ í•œê¸€ ê¹¨ì§ í™•ì¸
            const utf8Text = new TextDecoder('utf-8').decode(buffer);
            // ê¹¨ì§„ ë¬¸ì(replacement character) í¬í•¨ ì—¬ë¶€ í™•ì¸
            const hasGarbled = utf8Text.includes('\uFFFD') ||
              // ë§¥ ì—‘ì…€ EUC-KR ì €ì¥ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” íŒ¨í„´ ê°ì§€
              /[\xC0-\xFF][\x80-\xBF]/.test(utf8Text) === false &&
              /[\x80-\xFF]/.test(utf8Text);
            if (hasGarbled) {
              // EUC-KRë¡œ ì¬ì‹œë„
              resolve(new TextDecoder('euc-kr').decode(buffer));
            } else {
              resolve(utf8Text);
            }
          }
        };
        reader.readAsArrayBuffer(file);
      });
    }

    /************************************************************
     * 1. ë‹¨ì–´ ë°ì´í„° (ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ í•„ìš”)
     ************************************************************/
    let words = {};

    /************************************************************
     * 2. ìƒíƒœ ë³€ìˆ˜
     ************************************************************/
    let currentDays = []; // ì„ íƒëœ Day ë°°ì—´
    let currentMode = "meaning";
    let currentExamMode = "practice"; // 'practice' | 'real'
    let currentList = [];
    let maxQuestions = 0; // ìµœëŒ€ ë¬¸ì œ ê°œìˆ˜ (0 = ì „ì²´)
    let currentIndex = -1;
    let lastIndex = -1;
    let correctCount = 0;
    let totalCount = 0;
    let isChecked = false;
    let askedWords = new Set(); // ì´ë¯¸ ë‚˜ì˜¨ ë‹¨ì–´ ì¶”ì 
    
    // í‹€ë¦° ë‹¨ì–´ ì €ì¥ (ë©”ëª¨ë¦¬ ì‚¬ìš©)
    let wrongWords = {}; // { "day-word": { english, meanings, synonyms, count, day } }

    /************************************************************
     * 3. DOM ìš”ì†Œ
     ************************************************************/
    const daySelectorHeader = document.getElementById("daySelectorHeader");
    const daySelectorContent = document.getElementById("daySelectorContent");
    const selectedDaysPreview = document.getElementById("selectedDaysPreview");
    const arrowIcon = document.getElementById("arrowIcon");
    const modeSelect = document.getElementById("modeSelect");
    const examMode = document.getElementById("examMode");
    const questionCount = document.getElementById("questionCount");
    const startBtn = document.getElementById("startBtn");
    const wrongWordsBtn = document.getElementById("wrongWordsBtn");
    const setupSection = document.getElementById("setupSection");
    const quizSection = document.getElementById("quizSection");
    const wordBox = document.getElementById("wordBox");
    const answerInput = document.getElementById("answerInput");
    const answerLabel = document.getElementById("answerLabel");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const resultDiv = document.getElementById("result");
    const correctBox = document.getElementById("correctBox");
    const scoreBox = document.getElementById("scoreBox");
    const homeBtn = document.getElementById("homeBtn");
    const resultSection = document.getElementById("resultSection");
    const homeBtn2 = document.getElementById("homeBtn2");
    const retryBtn = document.getElementById("retryBtn");
    const wrongWordsSection = document.getElementById("wrongWordsSection");
    const homeBtn3 = document.getElementById("homeBtn3");
    const clearWrongBtn = document.getElementById("clearWrongBtn");
    const wrongDayFilter = document.getElementById("wrongDayFilter");
    const wrongWordsList = document.getElementById("wrongWordsList");
    const excelFile = document.getElementById("excelFile");
    const downloadWrongBtn = document.getElementById("downloadWrongBtn");
    const uploadWrongBtn = document.getElementById("uploadWrongBtn");
    const wrongWordsFile = document.getElementById("wrongWordsFile");
    const startWrongWordsQuizBtn = document.getElementById("startWrongWordsQuizBtn");
    const startWrongWordsQuizBtnHome = document.getElementById("startWrongWordsQuizBtnHome");
    const wrongWordsBtnsContainer = document.getElementById("wrongWordsBtnsContainer");

    /************************************************************
     * 3-1. íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (ì—‘ì…€ ë˜ëŠ” CSV)
     ************************************************************/
    excelFile.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const fileName = file.name.toLowerCase();
      const isCSV = fileName.endsWith('.csv');

      try {
        let jsonData = [];

        if (isCSV) {
          // CSV íŒŒì¼ ì²˜ë¦¬ (ì¸ì½”ë”© ìë™ ê°ì§€ - ë§¥ ì—‘ì…€ í•œê¸€ ê¹¨ì§ ëŒ€ì‘)
          const text = await readFileWithEncoding(file);
          const result = Papa.parse(text, {
            header: true,
            skipEmptyLines: true,
            dynamicTyping: false
          });
          jsonData = result.data;
        } else {
          // ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬
          const data = await file.arrayBuffer();
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];
          jsonData = XLSX.utils.sheet_to_json(sheet);
        }

        // ë°ì´í„° íŒŒì‹±
        const newWords = {};
        
        for (const row of jsonData) {
          const day = String(row.Category || row.category || row.Day || row.day || '').trim();
          if (!day) continue;

          const english = String(row.English || row.english || row.Words || row.words || row.Word || row.word || '').trim();
          const meanings = String(row.Meanings || row.meanings || '')
            .split(/[,/;]/)
            .map(s => s.trim())
            .filter(s => s.length > 0);
          const synonyms = String(row.Synonyms || row.synonyms || '')
            .split(/[,/;]/)
            .map(s => s.trim())
            .filter(s => s.length > 0);

          if (!english) continue;

          if (!newWords[day]) {
            newWords[day] = [];
          }

          newWords[day].push({
            english: english,
            meanings: meanings,
            synonyms: synonyms
          });
        }

        if (Object.keys(newWords).length === 0) {
          alert('ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        words = newWords;
        saveWordsToStorage(); // âœ… localStorageì— ë‹¨ì–´ ë°ì´í„° ì €ì¥
        initDayOptions();

        // ì—…ë¡œë“œ ê²½ê³  ë¬¸êµ¬ ìˆ¨ê¸°ê¸°
        const uploadWarning = document.getElementById('uploadWarning');
        if (uploadWarning) {
          uploadWarning.style.display = 'none';
        }

        alert(`âœ… ${Object.keys(words).length}ê°œ Category, ì´ ${Object.values(words).reduce((sum, arr) => sum + arr.length, 0)}ê°œ ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\nğŸ’¾ ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì–´ ë‹¤ìŒì— ì ‘ì†í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.`);
      } catch (error) {
        console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
    
    /************************************************************
     * 4. ì´ˆê¸°í™”: Day ì˜µì…˜ ìƒì„±
     ************************************************************/
    function initDayOptions() {
      const dayKeys = Object.keys(words)
        .filter(k => Array.isArray(words[k]) && words[k].length > 0)
        .sort((a, b) => {
          // ìˆ«ìë©´ ìˆ«ì ìˆœ, ì•„ë‹ˆë©´ ë¬¸ìì—´ ìˆœ
          const na = Number(a), nb = Number(b);
          if (!isNaN(na) && !isNaN(nb)) return na - nb;
          return a.localeCompare(b);
        });

      daySelectorContent.innerHTML = '';

      if (dayKeys.length === 0) {
        // âœ… ì—…ë¡œë“œ ì „ì—ëŠ” 'ë°ì´í„° ì—†ìŒ' ëŒ€ì‹  ì•ˆë‚´ ë¬¸êµ¬
        daySelectorContent.innerHTML = `
          <div style="padding: 12px; text-align: center; color: var(--text-muted); font-size: 13px;">
            íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ Category ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤
          </div>
        `;

        // Day ì„ íƒê¸° ê¸°ë³¸ ì ‘í˜ + ì•ˆë‚´ í…ìŠ¤íŠ¸
        daySelectorContent.classList.remove('expanded');
        arrowIcon.classList.remove('expanded');
        selectedDaysPreview.textContent = 'íŒŒì¼ ì—…ë¡œë“œ í›„ ì„ íƒí•˜ì„¸ìš”';

        startBtn.disabled = true;
        startBtn.textContent = "ë‹¨ì–´ ë°ì´í„°ë¥¼ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”";
        return;
      }

      // Day ì„ íƒ í™œì„±í™”
      startBtn.disabled = false;
      startBtn.textContent = "ì‹œí—˜ ì‹œì‘í•˜ê¸° ğŸš€";
      daySelectorContent.classList.remove('expanded');
      arrowIcon.classList.remove('expanded');
      updateSelectedDaysPreview();
      updateSavedWordsStatus();

      // Day ì²´í¬ë°•ìŠ¤ ì˜µì…˜ ìƒì„±
      for (const day of dayKeys) {
        const optionDiv = document.createElement("div");
        optionDiv.className = "day-option";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `day-${day}`;
        checkbox.value = day;
        checkbox.className = "day-checkbox";

        const label = document.createElement("label");
        label.htmlFor = `day-${day}`;
        label.textContent = `${day} (${words[day].length}ê°œ ë‹¨ì–´)`;
        label.style.userSelect = 'none'; // í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€

        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
        checkbox.addEventListener('change', updateSelectedDaysPreview);

        // í´ë¦­ ì‹œ ì²´í¬ë°•ìŠ¤ í† ê¸€
        optionDiv.addEventListener('click', (e) => {
          // ì²´í¬ë°•ìŠ¤ ì§ì ‘ í´ë¦­ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í† ê¸€
          if (e.target !== checkbox && e.target.tagName !== 'INPUT') {
            e.preventDefault();
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
          }
        });

        optionDiv.appendChild(checkbox);
        optionDiv.appendChild(label);
        daySelectorContent.appendChild(optionDiv);
      }

      // í‹€ë¦° ë‹¨ì–´ í•„í„°ìš© ì˜µì…˜ë„ ìƒì„±
      wrongDayFilter.innerHTML = '<option value="all">ì „ì²´ ë³´ê¸°</option>';
      for (const day of dayKeys) {
        const opt = document.createElement("option");
        opt.value = day;
        opt.textContent = `${day}`;
        wrongDayFilter.appendChild(opt);
      }
    }

    /************************************************************
     * 4-0. Day ì„ íƒê¸° í† ê¸€ ë° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
     ************************************************************/
    // Day ì„ íƒê¸° í† ê¸€
    daySelectorHeader.addEventListener('click', () => {
      const isExpanded = daySelectorContent.classList.toggle('expanded');
      arrowIcon.classList.toggle('expanded', isExpanded);
    });

    // ì„ íƒëœ Day ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updateSelectedDaysPreview() {
      const checkboxes = document.querySelectorAll('.day-checkbox:checked');
      const selectedDays = Array.from(checkboxes).map(cb => cb.value).sort((a, b) => {
        const na = Number(a), nb = Number(b);
        if (!isNaN(na) && !isNaN(nb)) return na - nb;
        return a.localeCompare(b);
      });

      if (selectedDays.length === 0) {
        selectedDaysPreview.textContent = 'ì„ íƒí•˜ì„¸ìš”';
      } else if (selectedDays.length === 1) {
        selectedDaysPreview.textContent = `${selectedDays[0]}`;
      } else {
        selectedDaysPreview.textContent = `${selectedDays.join(', ')} (${selectedDays.length}ê°œ)`;
      }
    }
    
    /************************************************************
     * 4-1. í‹€ë¦° ë‹¨ì–´ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (localStorage ì‚¬ìš©)
     ************************************************************/
    function loadWrongWords() {
      try {
        const saved = localStorage.getItem('wrongWords');
        if (saved) {
          wrongWords = JSON.parse(saved);
        }
      } catch (error) {
        console.error('í‹€ë¦° ë‹¨ì–´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
      }
      updateWrongWordsButton();
    }

    function saveWrongWords() {
      try {
        localStorage.setItem('wrongWords', JSON.stringify(wrongWords));
      } catch (error) {
        console.error('í‹€ë¦° ë‹¨ì–´ ì €ì¥ ì‹¤íŒ¨:', error);
      }
      updateWrongWordsButton();
    }
    
    function updateWrongWordsButton() {
      const count = Object.keys(wrongWords).length;
      if (count > 0) {
        wrongWordsBtnsContainer.style.display = 'flex';
        wrongWordsBtn.textContent = `âŒ í‹€ë¦° ë‹¨ì–´ ëª©ë¡ (${count}ê°œ)`;
      } else {
        wrongWordsBtnsContainer.style.display = 'none';
      }
    }

    /************************************************************
     * 4-2. ë¬¸ì œ ìˆ˜ ì…ë ¥ ì‹œ ê²½ê³  ìë™ ìˆ¨ê¹€
     ************************************************************/
    questionCount.addEventListener("input", () => {
      document.getElementById("questionCountWarning").style.display = "none";
    });

    /************************************************************
     * 5. ì‹œí—˜ ì‹œì‘
     ************************************************************/
    startBtn.addEventListener("click", () => {
      // ì„ íƒëœ Dayë“¤ ê°€ì ¸ì˜¤ê¸°
      const checkboxes = document.querySelectorAll('.day-checkbox:checked');
      const selectedDays = Array.from(checkboxes)
        .map(cb => cb.value)
        .filter(day => day && Array.isArray(words[day]) && words[day].length > 0)
        .sort((a, b) => {
          const na = Number(a), nb = Number(b);
          if (!isNaN(na) && !isNaN(nb)) return na - nb;
          return a.localeCompare(b);
        });

      if (selectedDays.length === 0) {
        alert("Categoryë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");
        return;
      }

      // ë¬¸ì œ ê°œìˆ˜ ì„¤ì •
      const countValue = Number(questionCount.value);
      if (isNaN(countValue) || countValue < 0) {
        alert("ì˜¬ë°”ë¥¸ ë¬¸ì œ ê°œìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! (0 = ì „ì²´)");
        return;
      }

      // ì„ íƒëœ Day ì „ì²´ ë‹¨ì–´ ìˆ˜ ê³„ì‚°
      const totalWordCount = selectedDays.reduce((sum, day) => sum + (words[day] ? words[day].length : 0), 0);
      if (countValue > totalWordCount) {
        const warningEl = document.getElementById("questionCountWarning");
        warningEl.textContent = `âš ï¸ ì„ íƒí•œ Categoryì˜ ë‹¨ì–´ ìˆ˜(${totalWordCount}ê°œ)ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.`;
        warningEl.style.display = "block";
        questionCount.focus();
        return;
      }
      // ê²½ê³  ìˆ¨ê¸°ê¸°
      document.getElementById("questionCountWarning").style.display = "none";

      maxQuestions = countValue; // 0ì€ ì „ì²´ ë¬¸ì œ

      currentDays = selectedDays;
      currentMode = modeSelect.value;
      currentExamMode = examMode.value;

      // ì„ íƒëœ ëª¨ë“  Dayì˜ ë‹¨ì–´ë“¤ì„ í•©ì¹˜ê¸°
      currentList = [];
      for (const day of currentDays) {
        const dayWords = words[day].map(word => ({
          ...word,
          day: day // ì–´ëŠ Dayì˜ ë‹¨ì–´ì¸ì§€ ì¶”ì 
        }));
        currentList = currentList.concat(dayWords);
      }

      // ë¬¸ì œ ê°œìˆ˜ê°€ ì§€ì •ë˜ì—ˆê³  ì „ì²´ ë‹¨ì–´ ìˆ˜ë³´ë‹¤ ì ìœ¼ë©´ ì œí•œ
      if (maxQuestions > 0 && maxQuestions < currentList.length) {
        // ëœë¤í•˜ê²Œ ì„ê¸°
        currentList = currentList.sort(() => Math.random() - 0.5);
        // ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ë§Œ ìë¥´ê¸°
        currentList = currentList.slice(0, maxQuestions);
      }

      currentIndex = -1;
      lastIndex = -1;
      correctCount = 0;
      totalCount = 0;
      isChecked = false;
      askedWords.clear();

      setupSection.style.display = "none";
      quizSection.classList.add("visible");
      resultSection.style.display = "none";
      wrongWordsSection.style.display = "none";

      updateAnswerLabel();
      updateScore();
      pickNewWord();

      // ì‹œí—˜ ëª¨ë“œ ë°°ì§€ ì»¨í…Œì´ë„ˆ ìƒì„±
      const badgesContainer = document.createElement('div');
      badgesContainer.className = 'exam-badges-container';
      badgesContainer.id = 'examBadgesContainer';

      // ì‹œí—˜ ëª¨ë“œ ë°°ì§€
      const modeBadge = document.createElement('div');
      modeBadge.className = currentExamMode === 'practice' ? 'exam-mode-badge badge-practice' : 'exam-mode-badge badge-real';
      modeBadge.textContent = currentExamMode === 'practice' ? 'ğŸ“ ì—°ìŠµ' : 'ğŸ”¥ ì‹¤ì „';

      badgesContainer.appendChild(modeBadge);

      // ê° Categoryë³„ë¡œ ë°°ì§€ ìƒì„±
      for (const day of currentDays) {
        const dayBadge = document.createElement('div');
        dayBadge.className = 'badge-day';
        dayBadge.textContent = `${day}`;
        badgesContainer.appendChild(dayBadge);
      }

      // ê¸°ì¡´ ë°°ì§€ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
      const existingContainer = document.getElementById('examBadgesContainer');
      if (existingContainer) {
        existingContainer.remove();
      }
      wordBox.parentElement.insertBefore(badgesContainer, wordBox);
    });

    /************************************************************
     * 6. ìƒˆ ë¬¸ì œ ë½‘ê¸°
     ************************************************************/
    function pickNewWord() {
      if (!currentList || currentList.length === 0) return;

      // ëª¨ë“  ë‹¨ì–´ë¥¼ ë‹¤ í’€ì—ˆëŠ”ì§€ í™•ì¸
      if (askedWords.size >= currentList.length) {
        showFinalResult();
        return;
      }

      // ë¬¸ì œ ê°œìˆ˜ ì œí•œì´ ìˆê³ , ì´ë¯¸ ê·¸ë§Œí¼ í’€ì—ˆìœ¼ë©´ ì¢…ë£Œ
      if (maxQuestions > 0 && askedWords.size >= maxQuestions) {
        showFinalResult();
        return;
      }

      // ì•„ì§ ì•ˆ ë‚˜ì˜¨ ë‹¨ì–´ ì¤‘ì—ì„œ ëœë¤ ì„ íƒ
      let idx;
      do {
        idx = Math.floor(Math.random() * currentList.length);
      } while (askedWords.has(idx));
      
      currentIndex = idx;
      askedWords.add(idx);

      const item = currentList[currentIndex];
      wordBox.textContent = item.english;

      answerInput.value = "";
      resultDiv.textContent = "";
      resultDiv.className = "result";
      correctBox.style.display = "none";
      correctBox.textContent = "";
      isChecked = false;

      checkBtn.disabled = false;
      answerInput.disabled = false;
      answerInput.focus();

      updateProgress();
    }

    /************************************************************
     * 7. ì •ë‹µ í™•ì¸
     ************************************************************/
    checkBtn.addEventListener("click", () => {
      if (currentIndex < 0 || isChecked) return;

      const rawUser = answerInput.value.trim();
      if (!rawUser) {
        alert("ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      const item = currentList[currentIndex];
      const meaningText = (item.meanings || []).join(", ");
      const synonymText = (item.synonyms || []).join(", ");
      const fullAnswerText = `ëœ»: ${meaningText || "(ì—†ìŒ)"} | ë™ì˜ì–´: ${synonymText || "(ì—†ìŒ)"}`;

      // ì •ë‹µ ë°°ì—´ ì¤€ë¹„
      let correctAnswers = [];
      let normalizeFunc = null;

      if (currentMode === "meaning") {
        correctAnswers = item.meanings || [];
        normalizeFunc = normalizeKorean;
      } else if (currentMode === "synonym") {
        correctAnswers = item.synonyms || [];
        normalizeFunc = normalizeEnglish;
      }

      const correctNorm = correctAnswers.map(normalizeFunc);

      // â”€â”€ ìœ ì—°í•œ ì…ë ¥ íŒŒì‹± â”€â”€
      // 1ì°¨: êµ¬ë¶„ì(ì½¤ë§ˆ/ìŠ¬ë˜ì‹œ ë“±)ë¡œ ë¶„ë¦¬
      let userParts = rawUser
        .split(/[,/;Â·|]/)
        .map(s => s.trim())
        .filter(s => s.length > 0);

      // 2ì°¨: êµ¬ë¶„ì ì—†ì´ ì…ë ¥í•œ ê²½ìš°, ì •ë‹µë“¤ì˜ ì¡°í•©ìœ¼ë¡œ ì „ì²´ ë¬¸ìì—´ ë§¤ì¹­ ì‹œë„
      // ì…ë ¥ëœ íŒŒíŠ¸ ì¤‘ í•˜ë‚˜ë„ ì •ë‹µì— ì—†ìœ¼ë©´ ê³µë°±/ë¶™ì—¬ì“°ê¸° ë§¤ì¹­ ì‹œë„
      const hasAnyMatch = userParts.some(up => correctNorm.includes(normalizeFunc(up)));
      if (!hasAnyMatch && correctAnswers.length > 1) {
        // ì •ë‹µ ëª©ë¡ì˜ ëª¨ë“  ìˆœì—´ë¡œ "ë¶™ì—¬ì“°ê¸°"/"ê³µë°± êµ¬ë¶„" ì¡°í•©ê³¼ ë¹„êµ
        const rawNorm = normalizeFunc(rawUser); // ì‚¬ìš©ì ì…ë ¥ ì •ê·œí™” (ê³µë°±ì œê±°)
        // ì •ë‹µë“¤ì„ ìˆœì—´ë¡œ ì¡°í•©í•´ì„œ ë¶™ì—¬ì“°ê¸° ë˜ëŠ” ê³µë°± ì—°ê²°ë¡œ ë¹„êµ
        const perms = getPermutations(correctNorm);
        let matched = null;
        for (const perm of perms) {
          // ë¶™ì—¬ì“°ê¸° ë¹„êµ (ê³µë°± ì „ë¶€ ì œê±°)
          if (perm.join('') === rawNorm.replace(/\s+/g,'')) {
            matched = perm;
            break;
          }
          // ê³µë°± 1ê°œë¡œ ì—°ê²° ë¹„êµ
          if (perm.join(' ').replace(/\s+/g,'') === rawNorm.replace(/\s+/g,'')) {
            matched = perm;
            break;
          }
        }
        if (matched) {
          // ì „ì²´ ì •ë‹µì„ ë‹¤ ì…ë ¥í•œ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
          userParts = correctAnswers.slice(); // ì •ë‹µ ì „ì²´ë¥¼ ì…ë ¥í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼
        }
      }

      // ê° ì‚¬ìš©ì ì…ë ¥ì´ ì •ë‹µì¸ì§€ í™•ì¸
      const userResults = userParts.map(up => ({
        input: up,
        isCorrect: correctNorm.includes(normalizeFunc(up))
      }));

      const correctUserCount = userResults.filter(r => r.isCorrect).length;
      const totalUserCount = userResults.length;
      const wrongUserCount = totalUserCount - correctUserCount;

      totalCount++;
      isChecked = true;
      checkBtn.disabled = true;
      answerInput.disabled = true;

      // ì •ë‹µ í…ìŠ¤íŠ¸ ì¤€ë¹„
      const answerText = correctAnswers.join(", ");

      // ì •ë‹µ íŒì •
      let isFullCorrect = false;
      let isPartialCorrect = false;

      // ì™„ì „ ì •ë‹µ ì¡°ê±´: ì…ë ¥í•œ ë‹µì´ ëª¨ë‘ ì •ë‹µì´ê³ , í‹€ë¦° ë‹µì´ ì—†ê³ , ì •ë‹µì„ ëª¨ë‘ ì…ë ¥í•œ ê²½ìš°
      const allCorrectAnswersProvided = correctUserCount >= correctAnswers.length;

      if (totalUserCount > 0 && correctUserCount === totalUserCount && wrongUserCount === 0 && allCorrectAnswersProvided) {
        // ëª¨ë‘ ì •ë‹µ (í‹€ë¦° ë‹µ ì—†ìŒ + ëª¨ë“  ì •ë‹µ ì…ë ¥)
        isFullCorrect = true;
      } else if (correctUserCount > 0) {
        // ì¼ë¶€ ì •ë‹µ (ì¼ë¶€ë§Œ ë§ìŒ, ë˜ëŠ” í‹€ë¦° ë‹µ í¬í•¨)
        isPartialCorrect = true;
      }

      if (isFullCorrect) {
        // ì™„ì „ ì •ë‹µ
        correctCount++;
        resultDiv.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
        resultDiv.className = "result correct";

        correctBox.textContent = `ì •ë‹µ: ${answerText || "(ì •ë‹µ ì—†ìŒ)"}\n${fullAnswerText}`;
        correctBox.style.display = "block";
        correctBox.style.whiteSpace = "pre-line";
      } else if (isPartialCorrect) {
        // ë¶€ë¶„ ì •ë‹µ (í‹€ë¦¼ ì²˜ë¦¬)
        const missingCount = correctAnswers.length - correctUserCount;

        if (wrongUserCount > 0) {
          // í‹€ë¦° ë‹µì´ í¬í•¨ëœ ê²½ìš°
          resultDiv.textContent = `ë¶€ë¶„ ì •ë‹µ âš ï¸ (${correctUserCount}ê°œ ì •ë‹µ, ${wrongUserCount}ê°œ ì˜¤ë‹µ)`;
        } else {
          // ì •ë‹µë§Œ ì…ë ¥í–ˆì§€ë§Œ ì¼ë¶€ë§Œ ì…ë ¥í•œ ê²½ìš°
          resultDiv.textContent = `ë¶€ë¶„ ì •ë‹µ âš ï¸ (${correctUserCount}/${correctAnswers.length}ê°œ ì •ë‹µ ì…ë ¥, ${missingCount}ê°œ ëˆ„ë½)`;
        }
        resultDiv.className = "result partial";

        // ì–´ë–¤ ë‹µì´ ë§ê³  í‹€ë ¸ëŠ”ì§€ í‘œì‹œ
        const details = userResults.map(r =>
          r.isCorrect ? `âœ“ ${r.input}` : `âœ— ${r.input}`
        ).join(", ");

        if (wrongUserCount > 0) {
          correctBox.textContent = `ì…ë ¥í•œ ë‹µ: ${details}\nì •ë‹µ: ${answerText || "(ì •ë‹µ ì—†ìŒ)"}\n${fullAnswerText}`;
        } else {
          correctBox.textContent = `ì…ë ¥í•œ ë‹µ: ${details}\nì „ì²´ ì •ë‹µ: ${answerText || "(ì •ë‹µ ì—†ìŒ)"}\n${fullAnswerText}`;
        }
        correctBox.style.display = "block";
        correctBox.style.whiteSpace = "pre-line";

        // ì‹¤ì „ ëª¨ë“œì¼ ë•Œë§Œ í‹€ë¦° ë‹¨ì–´ ì €ì¥
        if (currentExamMode === 'real') {
          const wordDay = item.day || currentDays[0];
          const key = `${wordDay}-${item.english}`;
          const today = new Date().toISOString().split('T')[0];

          // ë¶€ë¶„ ì •ë‹µì—ì„œ ëª» ë§íŒ ëœ» ëª©ë¡
          const missedThisTime = correctAnswers.filter(ans => !correctNorm.includes(normalizeFunc(ans)) || !userResults.find(r => r.isCorrect && normalizeFunc(r.input) === normalizeFunc(ans)));
          // ì‹¤ì œë¡œ ì‚¬ìš©ìê°€ ì…ë ¥í–ˆì§€ë§Œ í‹€ë¦° ê²ƒ + ì•„ì˜ˆ ì…ë ¥ ì•ˆ í•œ ëˆ„ë½ ì •ë‹µ
          const missed = correctAnswers.filter(ans =>
            !userResults.some(r => r.isCorrect && normalizeFunc(r.input) === normalizeFunc(ans))
          );

          if (wrongWords[key]) {
            wrongWords[key].count++;
            wrongWords[key].lastDate = today;
            // ëˆ„ë½/í‹€ë¦° ëœ» ëˆ„ì 
            if (!wrongWords[key].missedDetails) wrongWords[key].missedDetails = {};
            for (const m of missed) {
              wrongWords[key].missedDetails[m] = (wrongWords[key].missedDetails[m] || 0) + 1;
            }
          } else {
            const missedDetails = {};
            for (const m of missed) missedDetails[m] = 1;
            wrongWords[key] = {
              english: item.english,
              meanings: item.meanings,
              synonyms: item.synonyms,
              day: wordDay,
              count: 1,
              firstDate: today,
              lastDate: today,
              missedDetails
            };
          }
          saveWrongWords();
        }
      } else {
        // ì™„ì „ ì˜¤ë‹µ
        resultDiv.textContent = "í‹€ë ¸ìŠµë‹ˆë‹¤ ğŸ˜¢";
        resultDiv.className = "result wrong";

        correctBox.textContent = `ì •ë‹µ: ${answerText || "(ì •ë‹µ ì—†ìŒ)"}\n${fullAnswerText}`;
        correctBox.style.display = "block";
        correctBox.style.whiteSpace = "pre-line";

        // ì‹¤ì „ ëª¨ë“œì¼ ë•Œë§Œ í‹€ë¦° ë‹¨ì–´ ì €ì¥ (ì™„ì „ ì˜¤ë‹µ - ëª¨ë“  ì •ë‹µì„ missedDetailsì— ê¸°ë¡)
        if (currentExamMode === 'real') {
          const wordDay = item.day || currentDays[0];
          const key = `${wordDay}-${item.english}`;
          const today = new Date().toISOString().split('T')[0];
          if (wrongWords[key]) {
            wrongWords[key].count++;
            wrongWords[key].lastDate = today;
            if (!wrongWords[key].missedDetails) wrongWords[key].missedDetails = {};
            for (const ans of correctAnswers) {
              wrongWords[key].missedDetails[ans] = (wrongWords[key].missedDetails[ans] || 0) + 1;
            }
          } else {
            const missedDetails = {};
            for (const ans of correctAnswers) missedDetails[ans] = 1;
            wrongWords[key] = {
              english: item.english,
              meanings: item.meanings,
              synonyms: item.synonyms,
              day: wordDay,
              count: 1,
              firstDate: today,
              lastDate: today,
              missedDetails
            };
          }
          saveWrongWords();
        }
      }

      updateScore();
    });

    /************************************************************
     * 8. ë‹¤ìŒ ë¬¸ì œ
     ************************************************************/
    nextBtn.addEventListener("click", () => {
      // ì •ë‹µ í™•ì¸ì„ ì•ˆ í–ˆìœ¼ë©´ í‹€ë¦° ê²ƒìœ¼ë¡œ ì²˜ë¦¬
      if (!isChecked) {
        const item = currentList[currentIndex];
        const meaningText = (item.meanings || []).join(", ");
        const synonymText = (item.synonyms || []).join(", ");
        const fullAnswerText = `ëœ»: ${meaningText || "(ì—†ìŒ)"} | ë™ì˜ì–´: ${synonymText || "(ì—†ìŒ)"}`;
        
        totalCount++;
        resultDiv.textContent = "ê±´ë„ˆë›°ì—ˆìŠµë‹ˆë‹¤ (í‹€ë¦¼ ì²˜ë¦¬) â­ï¸";
        resultDiv.className = "result wrong";

        const answerText =
          currentMode === "meaning"
            ? (item.meanings || []).join(", ")
            : (item.synonyms || []).join(", ");
        correctBox.textContent = `ì •ë‹µ: ${answerText || "(ì •ë‹µ ì—†ìŒ)"}\n${fullAnswerText}`;
        correctBox.style.display = "block";
        correctBox.style.whiteSpace = "pre-line";

        // í•œ ë²ˆ ë” Enter/ë‹¤ìŒ ë²„íŠ¼ìœ¼ë¡œ ë„˜ì–´ê°€ë„ë¡ ìƒíƒœ í‘œì‹œ
        isChecked = true;
        checkBtn.disabled = true;
        answerInput.disabled = true;
        
        // ì‹¤ì „ ëª¨ë“œì¼ ë•Œë§Œ í‹€ë¦° ë‹¨ì–´ ì €ì¥
        if (currentExamMode === 'real') {
          const wordDay = item.day || currentDays[0];
          const key = `${wordDay}-${item.english}`;
          const today = new Date().toISOString().split('T')[0];
          // ê±´ë„ˆë›°ê¸°: í˜„ì¬ ëª¨ë“œì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì •ë‹µì„ missedDetailsì— ê¸°ë¡
          const skippedAnswers = currentMode === 'meaning' ? (item.meanings || []) : (item.synonyms || []);
          if (wrongWords[key]) {
            wrongWords[key].count++;
            wrongWords[key].lastDate = today;
            if (!wrongWords[key].missedDetails) wrongWords[key].missedDetails = {};
            for (const ans of skippedAnswers) {
              wrongWords[key].missedDetails[ans] = (wrongWords[key].missedDetails[ans] || 0) + 1;
            }
          } else {
            const missedDetails = {};
            for (const ans of skippedAnswers) missedDetails[ans] = 1;
            wrongWords[key] = {
              english: item.english,
              meanings: item.meanings,
              synonyms: item.synonyms,
              day: wordDay,
              count: 1,
              firstDate: today,
              lastDate: today,
              missedDetails
            };
          }
          saveWrongWords();
        }

        updateScore();
      } else {
        // ì´ë¯¸ ì •ë‹µ í™•ì¸ì„ í–ˆìœ¼ë©´ ë°”ë¡œ ë‹¤ìŒ ë¬¸ì œ
        pickNewWord();
      }
    });

    /************************************************************
     * 9. í‚¤ ì²˜ë¦¬ (Enter = ì •ë‹µ í™•ì¸, Space = ë‹¤ìŒ ë¬¸ì œ)
     ************************************************************/
    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        if (!isChecked) {
          checkBtn.click();
        }
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === " " && quizSection.classList.contains("visible")) {
        // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤ê°€ ìˆìœ¼ë©´ ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ í—ˆìš© (íƒ€ì´í•‘ ì¤‘)
        if (document.activeElement === answerInput && !isChecked) return;
        e.preventDefault();
        if (isChecked) {
          nextBtn.click();
        }
      }
    });

    /************************************************************
     * 10. ì ìˆ˜ í‘œì‹œ
     ************************************************************/
    function updateScore() {
      if (totalCount === 0) {
        scoreBox.textContent = "ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”!";
        return;
      }
      const rate = ((correctCount / totalCount) * 100).toFixed(1);
      scoreBox.textContent = `ì •ë‹µë¥ : ${correctCount} / ${totalCount} (${rate}%)`;
    }

    /************************************************************
     * 10-1. ì§„í–‰ë„ í‘œì‹œ
     ************************************************************/
    function updateProgress() {
      const totalQuestions = maxQuestions > 0 ? Math.min(maxQuestions, currentList.length) : currentList.length;
      const progress = `ì§„í–‰: ${askedWords.size} / ${totalQuestions} ë¬¸ì œ`;
      scoreBox.textContent = (totalCount === 0 ? "" : scoreBox.textContent + " | ") + progress;
    }

    /************************************************************
     * 10-2. ìµœì¢… ê²°ê³¼ í™”ë©´
     ************************************************************/
    function showFinalResult() {
      quizSection.style.display = "none";
      resultSection.style.display = "block";

      const rate = totalCount > 0 ? ((correctCount / totalCount) * 100).toFixed(1) : 0;
      const wrongCount = totalCount - correctCount;

      document.getElementById("finalRate").textContent = rate + "%";
      document.getElementById("finalDetail").textContent = `${correctCount} / ${totalCount} ì •ë‹µ`;
      document.getElementById("wrongCount").textContent = `í‹€ë¦° ë¬¸ì œ: ${wrongCount}ê°œ`;
      document.getElementById("correctCountText").textContent = `ë§íŒ ë¬¸ì œ: ${correctCount}ê°œ`;
    }

    /************************************************************
     * 10-3. í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
     ************************************************************/
    function goHome() {
      setupSection.style.display = "block";
      quizSection.style.display = "none";
      quizSection.classList.remove("visible");
      resultSection.style.display = "none";
      wrongWordsSection.style.display = "none";

      // ì‹œí—˜ ëª¨ë“œ ë°°ì§€ ì»¨í…Œì´ë„ˆ ì œê±°
      const badgesContainer = document.getElementById('examBadgesContainer');
      if (badgesContainer) badgesContainer.remove();

      // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
      currentDays = [];
      currentMode = "meaning";
      currentExamMode = "practice";
      currentList = [];
      maxQuestions = 0;
      currentIndex = -1;
      lastIndex = -1;
      correctCount = 0;
      totalCount = 0;
      isChecked = false;
      askedWords.clear();

      // UI ì´ˆê¸°í™”
      wordBox.textContent = "ë‹¨ì–´";
      answerInput.value = "";
      resultDiv.textContent = "";
      resultDiv.className = "result";
      correctBox.textContent = "";
      correctBox.style.display = "none";
      scoreBox.textContent = "";

      // Category ì„ íƒë§Œ ì´ˆê¸°í™” (ì‹œí—˜ ìœ í˜•/ëª¨ë“œ/ë¬¸ì œìˆ˜ëŠ” ì´ì „ ì„¤ì • ìœ ì§€)
      const checkboxes = document.querySelectorAll('.day-checkbox');
      checkboxes.forEach(cb => cb.checked = false);
      updateSelectedDaysPreview();
    }

    homeBtn.addEventListener("click", goHome);
    homeBtn2.addEventListener("click", goHome);
    homeBtn3.addEventListener("click", goHome);

    /************************************************************
     * 10-4. ì¬ì‹œì‘
     ************************************************************/
    retryBtn.addEventListener("click", () => {
      if (currentDays.length === 0) return;

      // ì„ íƒëœ ëª¨ë“  Dayì˜ ë‹¨ì–´ë“¤ì„ ë‹¤ì‹œ í•©ì¹˜ê¸°
      currentList = [];
      for (const day of currentDays) {
        const dayWords = words[day].map(word => ({
          ...word,
          day: day
        }));
        currentList = currentList.concat(dayWords);
      }

      currentIndex = -1;
      lastIndex = -1;
      correctCount = 0;
      totalCount = 0;
      isChecked = false;
      askedWords.clear();

      resultSection.style.display = "none";
      quizSection.style.display = "block";

      updateScore();
      pickNewWord();
    });
    
    /************************************************************
     * 10-5. í‹€ë¦° ë‹¨ì–´ ëª©ë¡ ë³´ê¸°
     ************************************************************/
    wrongWordsBtn.addEventListener("click", () => {
      setupSection.style.display = "none";
      wrongWordsSection.style.display = "block";
      displayWrongWords('all');
    });
    
    function displayWrongWords(filterDay) {
      wrongWordsList.innerHTML = '';

      const filtered = Object.entries(wrongWords).filter(([key, data]) => {
        if (filterDay === 'all') return true;
        return String(data.day) === String(filterDay);
      });

      if (filtered.length === 0) {
        wrongWordsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      // í‹€ë¦° íšŸìˆ˜ ë§ì€ ìˆœìœ¼ë¡œ ì •ë ¬
      filtered.sort((a, b) => b[1].count - a[1].count);

      for (const [key, data] of filtered) {
        const item = document.createElement('div');
        item.className = 'wrong-word-item';

        // â”€â”€ ìƒë‹¨ í–‰: ë‹¨ì–´ ì •ë³´ + í‹€ë¦° íšŸìˆ˜ ë°°ì§€ â”€â”€
        const topRow = document.createElement('div');
        topRow.className = 'wrong-word-top-row';

        const info = document.createElement('div');
        info.className = 'wrong-word-info';

        const english = document.createElement('div');
        english.className = 'wrong-word-english';
        english.textContent = `${data.english} (${data.day})`;

        const meaning = document.createElement('div');
        meaning.className = 'wrong-word-meaning';
        meaning.textContent = `ëœ»: ${data.meanings.join(', ')} | ë™ì˜ì–´: ${data.synonyms.join(', ')}`;

        info.appendChild(english);
        info.appendChild(meaning);

        const rightCol = document.createElement('div');
        rightCol.className = 'wrong-word-right-col';

        const count = document.createElement('div');
        count.className = 'wrong-word-count';
        const countNum = Math.min(data.count, 10);
        count.classList.add(`wrong-count-${countNum}`);
        count.textContent = `${data.count}ë²ˆ í‹€ë¦¼`;

        // ìƒì„¸ ê¸°ë¡ í† ê¸€ ë²„íŠ¼ (missedDetailsê°€ ìˆì„ ë•Œë§Œ)
        const hasMissed = data.missedDetails && Object.keys(data.missedDetails).length > 0;
        if (hasMissed) {
          const detailToggle = document.createElement('button');
          detailToggle.className = 'detail-toggle-btn';
          detailToggle.textContent = 'ìƒì„¸ ê¸°ë¡ â–¾';

          // ìƒì„¸ íŒ¨ë„ (ê¸°ë³¸ ìˆ¨ê¹€)
          const detailPanel = document.createElement('div');
          detailPanel.className = 'detail-panel';
          detailPanel.style.display = 'none';

          // missedDetails ì •ë ¬ (ë§ì´ í‹€ë¦° ìˆœ)
          const sortedMissed = Object.entries(data.missedDetails)
            .sort((a, b) => b[1] - a[1]);

          const totalMissedCount = sortedMissed.reduce((s, [, c]) => s + c, 0);

          const reportTitle = document.createElement('div');
          reportTitle.className = 'detail-report-title';
          reportTitle.textContent = `ğŸ“Š ì˜¤ë‹µ ë¦¬í¬íŠ¸ (ì´ ${totalMissedCount}íšŒ ëˆ„ë½)`;
          detailPanel.appendChild(reportTitle);

          for (const [ans, cnt] of sortedMissed) {
            const row = document.createElement('div');
            row.className = 'detail-missed-row';

            const bar = document.createElement('div');
            bar.className = 'detail-missed-bar-wrap';

            const label = document.createElement('span');
            label.className = 'detail-missed-label';
            label.textContent = ans;

            const barTrack = document.createElement('div');
            barTrack.className = 'detail-bar-track';

            const barFill = document.createElement('div');
            barFill.className = 'detail-bar-fill';
            const pct = Math.round((cnt / totalMissedCount) * 100);
            barFill.style.width = pct + '%';

            // íšŸìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë” ë¶‰ì€ ìƒ‰
            const intensity = Math.min(cnt, 5);
            const colors = ['#fca5a5','#f87171','#ef4444','#dc2626','#b91c1c'];
            barFill.style.background = colors[intensity - 1] || colors[4];

            barTrack.appendChild(barFill);

            const cntBadge = document.createElement('span');
            cntBadge.className = 'detail-cnt-badge';
            cntBadge.textContent = `${cnt}íšŒ`;

            bar.appendChild(label);
            bar.appendChild(barTrack);
            bar.appendChild(cntBadge);
            row.appendChild(bar);
            detailPanel.appendChild(row);
          }

          // í† ê¸€ ë™ì‘
          detailToggle.addEventListener('click', () => {
            const isOpen = detailPanel.style.display !== 'none';
            detailPanel.style.display = isOpen ? 'none' : 'block';
            detailToggle.textContent = isOpen ? 'ìƒì„¸ ê¸°ë¡ â–¾' : 'ìƒì„¸ ê¸°ë¡ â–´';
          });

          rightCol.appendChild(count);
          rightCol.appendChild(detailToggle);
          topRow.appendChild(info);
          topRow.appendChild(rightCol);
          item.appendChild(topRow);
          item.appendChild(detailPanel);
        } else {
          rightCol.appendChild(count);
          topRow.appendChild(info);
          topRow.appendChild(rightCol);
          item.appendChild(topRow);
        }

        wrongWordsList.appendChild(item);
      }
    }
    
    wrongDayFilter.addEventListener('change', (e) => {
      displayWrongWords(e.target.value);
    });
    
    clearWrongBtn.addEventListener("click", () => {
      if (confirm('ëª¨ë“  í‹€ë¦° ë‹¨ì–´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        wrongWords = {};
        saveWrongWords();
        displayWrongWords(wrongDayFilter.value);
        alert('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    });

    // í‹€ë¦° ë‹¨ì–´ë¡œ ì‹œí—˜ ë³´ê¸° (ê³µí†µ í•¨ìˆ˜)
    function startWrongWordsQuiz(filterDay = 'all') {
      if (Object.keys(wrongWords).length === 0) {
        alert('í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      // í•„í„°ë§ëœ í‹€ë¦° ë‹¨ì–´ë§Œ ê°€ì ¸ì˜¤ê¸°
      let filteredWrongWords = Object.values(wrongWords);
      if (filterDay !== 'all') {
        filteredWrongWords = filteredWrongWords.filter(word => String(word.day) === String(filterDay));
      }

      if (filteredWrongWords.length === 0) {
        alert('ì„ íƒí•œ Categoryì— í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      // í‹€ë¦° ë‹¨ì–´ë¥¼ currentList í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      currentList = filteredWrongWords.map(word => ({
        english: word.english,
        meanings: word.meanings,
        synonyms: word.synonyms,
        day: word.day
      }));

      // ì‹œí—˜ ëª¨ë“œ ì„¤ì •
      currentMode = modeSelect.value;
      currentExamMode = "real"; // í‹€ë¦° ë‹¨ì–´ ë³µìŠµë„ ì‹¤ì „ ëª¨ë“œë¡œ (í‹€ë¦° íšŸìˆ˜ ì—…ë°ì´íŠ¸)
      currentDays = [...new Set(filteredWrongWords.map(w => String(w.day)))].sort((a, b) => {
        const na = Number(a), nb = Number(b);
        if (!isNaN(na) && !isNaN(nb)) return na - nb;
        return a.localeCompare(b);
      });
      maxQuestions = 0; // ì „ì²´ ì¶œì œ

      currentIndex = -1;
      lastIndex = -1;
      correctCount = 0;
      totalCount = 0;
      isChecked = false;
      askedWords.clear();

      wrongWordsSection.style.display = "none";
      setupSection.style.display = "none";
      quizSection.classList.add("visible");
      resultSection.style.display = "none";

      updateAnswerLabel();
      updateScore();
      pickNewWord();

      // ì‹œí—˜ ëª¨ë“œ ë°°ì§€ ìƒì„±
      const badgesContainer = document.createElement('div');
      badgesContainer.className = 'exam-badges-container';
      badgesContainer.id = 'examBadgesContainer';

      // ë³µìŠµ ëª¨ë“œ ë°°ì§€
      const modeBadge = document.createElement('div');
      modeBadge.className = 'exam-mode-badge badge-wrong-review';
      modeBadge.textContent = 'ğŸ”„ í‹€ë¦°ë‹¨ì–´ ë³µìŠµ';
      badgesContainer.appendChild(modeBadge);

      // Category ë°°ì§€ë“¤
      for (const day of currentDays) {
        const dayBadge = document.createElement('div');
        dayBadge.className = 'badge-day';
        dayBadge.textContent = `${day}`;
        badgesContainer.appendChild(dayBadge);
      }

      // ê¸°ì¡´ ë°°ì§€ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
      const existingContainer = document.getElementById('examBadgesContainer');
      if (existingContainer) {
        existingContainer.remove();
      }
      wordBox.parentElement.insertBefore(badgesContainer, wordBox);

      alert(`ğŸ“ ${filteredWrongWords.length}ê°œì˜ í‹€ë¦° ë‹¨ì–´ë¡œ ë³µìŠµ ì‹œí—˜ì„ ì‹œì‘í•©ë‹ˆë‹¤!`);
    }

    // í‹€ë¦° ë‹¨ì–´ ëª©ë¡ í˜ì´ì§€ì—ì„œ ì‹œí—˜ ì‹œì‘
    startWrongWordsQuizBtn.addEventListener("click", () => {
      const filterDay = wrongDayFilter.value;
      startWrongWordsQuiz(filterDay);
    });

    // í™ˆ í™”ë©´ì—ì„œ í‹€ë¦° ë‹¨ì–´ ì‹œí—˜ ì‹œì‘ (ì „ì²´)
    startWrongWordsQuizBtnHome.addEventListener("click", () => {
      startWrongWordsQuiz('all');
    });

    // í‹€ë¦° ë‹¨ì–´ ë‹¤ìš´ë¡œë“œ (CSV)
    downloadWrongBtn.addEventListener("click", () => {
      if (Object.keys(wrongWords).length === 0) {
        alert('ë‹¤ìš´ë¡œë“œí•  í‹€ë¦° ë‹¨ì–´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // CSV í—¤ë” (ì˜ì–´)
      let csvContent = 'Category,English,Meanings,Synonyms,Wrong Count,First Wrong Date,Last Wrong Date,Missed Details\n';

      // ë°ì´í„° í–‰ ì¶”ê°€
      for (const [key, data] of Object.entries(wrongWords)) {
        const meanings = data.meanings.join('; ');
        const synonyms = data.synonyms.join('; ');
        const firstDate = data.firstDate || '';
        const lastDate = data.lastDate || '';
        // missedDetailsë¥¼ "ëœ»:íšŸìˆ˜|ëœ»:íšŸìˆ˜" í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™”
        const missedStr = data.missedDetails
          ? Object.entries(data.missedDetails).map(([ans, cnt]) => `${ans}:${cnt}`).join('|')
          : '';
        csvContent += `${data.day},"${data.english}","${meanings}","${synonyms}",${data.count},${firstDate},${lastDate},"${missedStr}"\n`;
      }

      const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');

      const today = new Date().toISOString().split('T')[0];
      link.href = url;
      link.download = `í‹€ë¦°ë‹¨ì–´ê¸°ë¡_${today}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      alert(`ğŸ“¥ ${Object.keys(wrongWords).length}ê°œì˜ í‹€ë¦° ë‹¨ì–´ ê¸°ë¡ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
    });

    // í‹€ë¦° ë‹¨ì–´ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­
    uploadWrongBtn.addEventListener("click", () => {
      wrongWordsFile.click();
    });

    // í‹€ë¦° ë‹¨ì–´ íŒŒì¼ ì—…ë¡œë“œ (CSV)
    wrongWordsFile.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      try {
        // ì¸ì½”ë”© ìë™ ê°ì§€ (ë§¥ ì—‘ì…€ í•œê¸€ ê¹¨ì§ ëŒ€ì‘)
        const text = await readFileWithEncoding(file);
        const result = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: false
        });

        if (!result.data || result.data.length === 0) {
          alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
          return;
        }

        // CSV ë°ì´í„°ë¥¼ wrongWords í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        const loadedData = {};
        for (const row of result.data) {
          const day = String(row.Category || row.category || row.Day || row.day || '').trim();
          const english = String(row.English || row.english || '').trim();
          const meanings = String(row.Meanings || row.meanings || '')
            .split(/[;]/)
            .map(s => s.trim())
            .filter(s => s.length > 0);
          const synonyms = String(row.Synonyms || row.synonyms || '')
            .split(/[;]/)
            .map(s => s.trim())
            .filter(s => s.length > 0);
          const count = Number(row['Wrong Count'] || row.Count || row.count || 1);
          const firstDate = String(row['First Wrong Date'] || row.firstDate || '').trim();
          const lastDate = String(row['Last Wrong Date'] || row.lastDate || '').trim();

          // missedDetails ë³µì›: "ëœ»:íšŸìˆ˜|ëœ»:íšŸìˆ˜" í˜•ì‹ íŒŒì‹±
          const missedRaw = String(row['Missed Details'] || row.missedDetails || '').trim();
          const missedDetails = {};
          if (missedRaw) {
            for (const part of missedRaw.split('|')) {
              const colonIdx = part.lastIndexOf(':');
              if (colonIdx > 0) {
                const ans = part.slice(0, colonIdx).trim();
                const cnt = Number(part.slice(colonIdx + 1).trim());
                if (ans && !isNaN(cnt) && cnt > 0) missedDetails[ans] = cnt;
              }
            }
          }

          if (!day || !english) continue;

          const key = `${day}-${english}`;
          loadedData[key] = {
            english: english,
            meanings: meanings,
            synonyms: synonyms,
            day: day,
            count: count,
            firstDate: firstDate || undefined,
            lastDate: lastDate || undefined,
            missedDetails: Object.keys(missedDetails).length > 0 ? missedDetails : undefined
          };
        }

        if (Object.keys(loadedData).length === 0) {
          alert('ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        // ê¸°ì¡´ ê¸°ë¡ê³¼ ë³‘í•©í• ì§€ í™•ì¸
        if (Object.keys(wrongWords).length > 0) {
          const merge = confirm('ê¸°ì¡´ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.\n\ní™•ì¸: ê¸°ì¡´ ê¸°ë¡ê³¼ ë³‘í•©\nì·¨ì†Œ: ê¸°ì¡´ ê¸°ë¡ ì‚­ì œ í›„ ë¶ˆëŸ¬ì˜¤ê¸°');

          if (merge) {
            // ë³‘í•©: ê¸°ì¡´ ê¸°ë¡ + ìƒˆë¡œìš´ ê¸°ë¡
            for (const [key, data] of Object.entries(loadedData)) {
              if (wrongWords[key]) {
                // ê°™ì€ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ í‹€ë¦° íšŸìˆ˜ í•©ì‚°
                wrongWords[key].count += data.count;
                // missedDetails ë³‘í•©
                if (data.missedDetails) {
                  if (!wrongWords[key].missedDetails) wrongWords[key].missedDetails = {};
                  for (const [ans, cnt] of Object.entries(data.missedDetails)) {
                    wrongWords[key].missedDetails[ans] = (wrongWords[key].missedDetails[ans] || 0) + cnt;
                  }
                }
              } else {
                wrongWords[key] = data;
              }
            }
          } else {
            // ë®ì–´ì“°ê¸°
            wrongWords = loadedData;
          }
        } else {
          wrongWords = loadedData;
        }

        saveWrongWords();
        displayWrongWords(wrongDayFilter.value);
        alert(`ğŸ“¤ ${Object.keys(loadedData).length}ê°œì˜ í‹€ë¦° ë‹¨ì–´ ê¸°ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
      } catch (error) {
        console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì˜¬ë°”ë¥¸ í˜•ì‹ì˜ CSV íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
      }

      // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
      e.target.value = '';
    });

    /************************************************************
     * 11. Label ì—…ë°ì´íŠ¸
     ************************************************************/
    function updateAnswerLabel() {
      if (currentMode === "meaning") {
        answerLabel.textContent = "í•œê¸€ ëœ»ì„ ì…ë ¥í•˜ì„¸ìš”";
        answerInput.placeholder = "ì˜ˆ: ë²„ë¦¬ë‹¤, í¬ê¸°í•˜ë‹¤";
      } else if (currentMode === "synonym") {
        answerLabel.textContent = "ì˜ì–´ ë™ì˜ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”";
        answerInput.placeholder = "ì˜ˆ: desert, give up";
      }
    }

    /************************************************************
     * 12. ì •ê·œí™” í•¨ìˆ˜ ë° ìˆœì—´ í—¬í¼
     ************************************************************/
    // ë°°ì—´ ìˆœì—´ ìƒì„± (ìµœëŒ€ 6ê°œ ì´í•˜ì—ì„œë§Œ ì‘ë™, ì´ìƒì´ë©´ ë¹ˆ ë°°ì—´)
    function getPermutations(arr) {
      if (arr.length > 6) return [arr]; // ì„±ëŠ¥ ë³´í˜¸: ë„ˆë¬´ ë§ìœ¼ë©´ ì›ë³¸ë§Œ
      if (arr.length <= 1) return [arr];
      const result = [];
      for (let i = 0; i < arr.length; i++) {
        const rest = [...arr.slice(0, i), ...arr.slice(i + 1)];
        for (const perm of getPermutations(rest)) {
          result.push([arr[i], ...perm]);
        }
      }
      return result;
    }

    function normalizeKorean(str) {
      return str
        .replace(/\([^)]*\)/g, "") // ê´„í˜¸ì™€ ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±°
        .replace(/\[[^\]]*\]/g, "") // ëŒ€ê´„í˜¸ì™€ ëŒ€ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±°
        .toLowerCase()
        .replace(/\s+/g, ""); // ê³µë°± ì œê±°
    }

    function normalizeEnglish(str) {
      return str
        .replace(/\([^)]*\)/g, "") // ê´„í˜¸ì™€ ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±°
        .replace(/\[[^\]]*\]/g, "") // ëŒ€ê´„í˜¸ì™€ ëŒ€ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±°
        .toLowerCase()
        .replace(/\s+/g, " ")  // ì•ˆìª½ ê³µë°±ì€ í•˜ë‚˜ë¡œ
        .trim();
    }

    /************************************************************
     * 12-1. CSV ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
     ************************************************************/
    document.getElementById('downloadTemplateBtn').addEventListener('click', () => {
      const csvContent =
        'Category,Words,Meanings,Synonyms\n' +
        '1,abandon,"ë²„ë¦¬ë‹¤, í¬ê¸°í•˜ë‹¤","desert, give up, forsake"\n' +
        '1,abundant,"í’ë¶€í•œ, ë„‰ë„‰í•œ","plentiful, ample, rich"\n' +
        '2,concise,"ê°„ê²°í•œ, ê°„ëª…í•œ","brief, succinct, terse"\n';

      const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'WIT_ì–‘ì‹.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    });

    /************************************************************
     * 13. ë‹¨ì–´ ë°ì´í„° localStorage ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
     ************************************************************/
    function saveWordsToStorage() {
      try {
        localStorage.setItem('wordData', JSON.stringify(words));
      } catch (e) {
        console.warn('ë‹¨ì–´ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨ (ìš©ëŸ‰ ì´ˆê³¼ ê°€ëŠ¥):', e);
      }
    }

    function loadWordsFromStorage() {
      try {
        const saved = localStorage.getItem('wordData');
        if (saved) {
          words = JSON.parse(saved);
          return true;
        }
      } catch (e) {
        console.warn('ë‹¨ì–´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      return false;
    }

    function updateSavedWordsStatus() {
      const statusEl = document.getElementById('savedWordsStatus');
      const infoEl = document.getElementById('savedWordsInfo');
      if (!statusEl || !infoEl) return;

      const dayCount = Object.keys(words).length;
      const clearBtn = document.getElementById('clearWordsBtn');
      if (dayCount > 0) {
        const totalWords = Object.values(words).reduce((sum, arr) => sum + arr.length, 0);
        infoEl.textContent = `${dayCount}ê°œ Category Â· ${totalWords}ê°œ ë‹¨ì–´`;
        statusEl.style.display = 'flex';
        if (clearBtn) clearBtn.style.display = '';

        // ì—…ë¡œë“œ ê²½ê³  ìˆ¨ê¸°ê¸°
        const uploadWarning = document.getElementById('uploadWarning');
        if (uploadWarning) uploadWarning.style.display = 'none';
      } else {
        statusEl.style.display = 'none';
        if (clearBtn) clearBtn.style.display = 'none';
      }
    }

    // ë‹¨ì–´ ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('clearWordsBtn').addEventListener('click', () => {
      if (confirm('ì €ì¥ëœ ë‹¨ì–´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‹¤ìŒ ì ‘ì† ì‹œ íŒŒì¼ì„ ë‹¤ì‹œ ì˜¬ë ¤ì•¼ í•©ë‹ˆë‹¤.')) {
        localStorage.removeItem('wordData');
        words = {};
        initDayOptions();
        updateSavedWordsStatus();
      }
    });

    /************************************************************
     * 13-1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
     ************************************************************/
    const hadSavedWords = loadWordsFromStorage();
    initDayOptions();
    if (hadSavedWords) updateSavedWordsStatus();
    loadWrongWords();

/************************************************************
 * 14. Dark / Light Mode
 ************************************************************/
const themeToggle = document.getElementById("themeToggle");

function applyTheme(mode) {
  if (mode === "light") {
    document.body.classList.add("light");
    themeToggle.textContent = "â˜€ï¸ Light";
  } else {
    document.body.classList.remove("light");
    themeToggle.textContent = "ğŸŒ™ Dark";
  }
  localStorage.setItem("theme", mode);
}

// ì´ˆê¸° ì ìš©
const savedTheme = localStorage.getItem("theme") || "dark";
applyTheme(savedTheme);

// í´ë¦­ í† ê¸€
themeToggle.addEventListener("click", () => {
  const isLight = document.body.classList.contains("light");
  applyTheme(isLight ? "dark" : "light");
});
  </script>
</body>
</html>